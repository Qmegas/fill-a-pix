<html>
<head>
  <title></title>
<style type="text/css">
<!--
.td_norm {
        cursor: pointer;
        color: #000000;
}
.td_full {
        cursor: pointer;
        background-color: #000000;
        color: #FFFFFF;
}
.td_empt {
        cursor: pointer;
        background-color: #DDDDDD;
        color: #000000;
}
.chk_full {
        cursor: pointer;
        background-color: #000000;
        color: #BBBBBB;
}
.chk_empt {
        cursor: pointer;
        background-color: #DDDDDD;
        color: #BBBBBB;
}
.err_norm {
        cursor: pointer;
        color: #FF0000;
}
.err_full {
        cursor: pointer;
        background-color: #000000;
        color: #FF0000;
}
.err_empt {
        cursor: pointer;
        background-color: #DDDDDD;
        color: #FF0000;
}
-->
</style>
</head>
<body>

<script>
var x = 15;
var y = 15;
var sumcheck = 0;
var gtime = 0;
var gameover = false;
var cellb = Array(x*y);
var cellc = Array('','','','','1','','0','','','','','3','','2','','','8','8','5','','','','','','4','','','','4','','','8','8','','3','2','','5','5','','','5','6','','3','','','','','','','','','','3','','7','7','','','1','','','','2','4','','','','5','','7','7','','','','','','2','','5','','4','5','7','','','','2','','0','','2','','','','2','','','7','','4','','','','','3','5','6','4','4','','','','','','','','0','','','4','','','','','3','','5','','','','2','','','','','','4','','','','7','8','6','','','','1','','4','','','4','','','','7','8','7','','2','','','','','6','','6','','','7','','','7','5','','','','','','9','8','','','8','8','','8','','6','','','0','','','','9','','','8','9','','','8','','','','','','4','','','','','6','','','','','5','5','4','2','');

function drawTable()
{
        tmp = '<table border="1" bordercolor="#666666" cellpadding="0" cellspacing="0">';
        curnum = 0;
        for (j=0; j<y; j++)
        {
                tmp += '<tr>';
                for (i=0; i<x; i++)
                {
                        capt = cellc[curnum];
                        if (capt=='') capt = '&nbsp;';
                        tmp += '<td id="cl_'+curnum+'" class="td_norm" width="20" height="20" align="center" valign="middle" onClick="cellClick('+curnum+')"><b>'+capt+'</b></td>';
                        cellb[curnum] = 0;
                        curnum++;
                }
                tmp += '</tr>';
        }
        tmp += '</table>';
        document.getElementById('tab').innerHTML = tmp;
        timer();
}

function cellClick(cnum)
{
        if (gameover) return;

        var val = cellb[cnum];
        val++;
        if (val==3) val=0;
        if (val==0) sumcheck--;
        if (val==1) sumcheck++;
        cellb[cnum] = val;

        var curx = cnum%x;
        var cury = parseInt(cnum/x);

        redrawCell(curx-1,cury-1);
        redrawCell(curx,cury-1);
        redrawCell(curx+1,cury-1);
        redrawCell(curx-1,cury);
        redrawCell(curx,cury);
        redrawCell(curx+1,cury);
        redrawCell(curx-1,cury+1);
        redrawCell(curx,cury+1);
        redrawCell(curx+1,cury+1);

        if (sumcheck==(x*y))
            makeFullCheck(false);
}

function makeFullCheck(markit)
{
        var errorz = 0;
        for (cury=0; cury<y; cury++)
        {
                for (curx=0; curx<x; curx++)
                {
                        tmp = cellc[getIndex(curx,cury)];
                        if (tmp!='')
                        {
                                c_info = getCellInfo(curx,cury);
                                cnum = parseInt(tmp);
                                if (cnum<c_info[3] || (c_info[0]-cnum)<c_info[4])
                                {
                                        errorz++;
                                        if (markit) markError(curx,cury);
                                }
                        }
                }
        }
        if (!markit && errorz==0)
             gameover = true;
}

function markError(curx,cury)
{
        var cobj = document.getElementById('cl_'+getIndex(curx,cury));
        switch (cobj.className)
        {
                case 'td_norm':
                      cobj.className = 'err_norm';
                      break;
                case 'chk_full':
                case 'td_full':
                      cobj.className = 'err_full';
                      break;
                case 'chk_empt':
                case 'td_empt':
                      cobj.className = 'err_empt';
                      break;
        }
}

function getIndex(curx,cury)
{
        return cury*x+curx;
}

function redrawCell(curx,cury)
{
        if (curx<0 || curx>=x || cury<0 || cury>=y)
            return false;

        var c_info = getCellInfo(curx,cury);
        var indx = getIndex(curx,cury);
        var cobj = document.getElementById('cl_'+indx);
        if (c_info[0]==c_info[1])
        {
                switch (cellb[indx])
                {
                        case 1: cobj.className = 'chk_full'; break;
                        case 2: cobj.className = 'chk_empt'; break;
                }
        } else {
                switch (cellb[indx])
                {
                        case 0: cobj.className = 'td_norm'; break;
                        case 1: cobj.className = 'td_full'; break;
                        case 2: cobj.className = 'td_empt'; break;
                }
        }
}

function getCellInfo(curx,cury)
{
        var c_info = Array(1,0,0,0,0); //cells_around,cells_not_blank,blank_cells,full_cells,emty_cells
        var tmp;

        if ((curx-1)>=0 && (cury-1)>=0)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx-1,cury-1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((cury-1)>=0)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx,cury-1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((curx+1)<x && (cury-1)>=0)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx+1,cury-1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((curx-1)>=0)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx-1,cury)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        //Own cell
        tmp = cellb[getIndex(curx,cury)];
        if (tmp!=0) c_info[1]++;
        c_info[tmp+2]++;
        //own cell
        if ((curx+1)<x)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx+1,cury)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((curx-1)>=0 && (cury+1)<y)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx-1,cury+1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((cury+1)<y)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx,cury+1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }
        if ((curx+1)<x && (cury+1)<y)
        {
                c_info[0]++;
                tmp = cellb[getIndex(curx+1,cury+1)];
                if (tmp!=0) c_info[1]++;
                c_info[tmp+2]++;
        }

        return c_info;
}

function timer()
{
        gtime++;
        drawGameTime();
        if (!gameover)
             setTimeout('timer()',1000);
}

function drawGameTime()
{
        var hh = parseInt(gtime/3600);
        var mm = parseInt((gtime - hh*3600)/60);

        var shh = String(hh);
        if (shh.length==1) shh = '0'+shh;
        var smm = String(mm);
        if (smm.length==1) smm = '0'+smm;
        var sss = String(gtime%60);
        if (sss.length==1) sss = '0'+sss;
        document.getElementById('game_time').innerHTML = shh+':'+smm+':'+sss;
}
</script>

<div align="center">
  Game Time: <span id="game_time">00:00:00</span><br /><br />
  <span id="tab"></span><br /><br />
  <input type="button" value="Check Errors" onClick="makeFullCheck(true);"><br />
</div>
<script>drawTable();</script>
</body>
</html>
